<!DOCTYPE html>
<html lang="ca">
<head>
  <meta charset="UTF-8">
  <title>", no?" - Anna Puig</title>
  <link rel="icon" type="image/png" href="favicon.png">
  <style>
    body {
      margin: 0;
      height: 100vh;
      display: flex;
      font-family: Arial, sans-serif;
      color: white;
      overflow: hidden;
    }
    @media (orientation: portrait) {
      body {
        flex-direction: column;
      }
    }
    .counter {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      position: relative;
      overflow: hidden;
      user-select: none;
      -webkit-user-select: none;
      -ms-user-select: none;
      cursor: pointer;
    }
    .no { background-color: #e74c3c; }
    .si { background-color: #27ae60; }
    .vale { background-color: #2980b9; }
    .dacord { background-color: #f39c12; }
    .label { margin-bottom: 20px; font-weight: bold; font-size: 2em; z-index: 2; position: relative; }
    .number { font-size: 6em; font-weight: bold; z-index: 2; position: relative; display: inline-block; }
    .combo {
      position: absolute; font-size: 1.5em; font-weight: bold; transform: rotate(-30deg) scale(1); color: #fff; z-index:2; opacity:0;
      transition: opacity 0.3s, transform 0.3s; pointer-events:none; transform-origin: left bottom;
    }
    .combo.show { opacity:1; transform: rotate(-30deg) scale(1); }
    @keyframes comboPop {
      0% { transform: rotate(-30deg) scale(1); }
      50% { transform: rotate(-30deg) scale(1.8); }
      100% { transform: rotate(-30deg) scale(1); }
    }
    .combo.pop {
      animation: comboPop 0.3s ease-out;
    }
    .combo.hide {
      opacity: 0;
      transform: rotate(-30deg) scale(0.5);
    }
    #infoBtn {
      position: fixed; top: 15px; right: 15px;
      background: #333; color: white; border: none; border-radius: 50%;
      width: 35px; height: 35px; font-size: 18px; cursor: pointer; font-weight: bold;
      display: flex; align-items: center; justify-content: center; transition: background 0.3s; z-index: 2000;
    }
    #infoBtn:hover { background: #555; }
    #infoBox {
      display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
      background: white; color: #333; padding: 25px 30px; border-radius: 12px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.3); max-width: 350px; text-align: left; z-index: 3000; line-height: 1.6;
    }
    #infoBox h2 { margin-top:0; font-size:1.4em; margin-bottom:15px; color:#222; }
    #infoBox ul { padding-left:20px; }
    #infoBox li { margin-bottom:10px; }
    #closeInfo { position:absolute; top:8px; right:12px; background:none; border:none; font-size:18px; cursor:pointer; color:#888; transition:color 0.3s; }
    #closeInfo:hover { color:#000; }
    @keyframes chiclin {
      0% { transform: scale(1) rotate(0deg); }
      30% { transform: scale(1.4) rotate(15deg); }
      60% { transform: scale(0.9) rotate(-10deg); }
      100% { transform: scale(1) rotate(0deg); }
    }
    #resetMobileBtn {
      display: none;
      position: fixed;
      top: 15px;
      left: 15px;
      background: #333;
      color: white;
      border: none;
      border-radius: 50%;
      width: 38px;
      height: 38px;
      font-size: 20px;
      cursor: pointer;
      font-weight: bold;
      z-index: 2000;
      align-items: center;
      justify-content: center;
      box-shadow: 0 2px 8px rgba(0,0,0,0.18);
      transition: background 0.3s;
    }
    #resetMobileBtn:active { background: #555; }
    @media (pointer: coarse) {
      #resetMobileBtn { display: flex; }
    }
  </style>
</head>
<body>

<button id="resetMobileBtn" title="Reinicia">‚ü≤</button>
<div class="counter no" data-code="Space">
  <div class="label">No?</div>
  <div id="countNo" class="number">0</div>
  <div id="comboNo" class="combo"></div>
</div>
<div class="counter si" data-code="KeyZ">
  <div class="label">S√≠?</div>
  <div id="countSi" class="number">0</div>
  <div id="comboSi" class="combo"></div>
</div>
<div class="counter vale" data-code="KeyX">
  <div class="label">Vale?</div>
  <div id="countVale" class="number">0</div>
  <div id="comboVale" class="combo"></div>
</div>
<div class="counter dacord" data-code="KeyC">
  <div class="label">D'acord?</div>
  <div id="countDacord" class="number">0</div>
  <div id="comboDacord" class="combo"></div>
</div>

<button id="infoBtn">i</button>
<div id="infoBox">
  <button id="closeInfo">‚úñ</button>
  <h2>Controls</h2>
  <ul id="controlsList">
    <!-- Es genera din√†micament segons dispositiu -->
  </ul>
</div>

<script>
  const counters = {
    Space: document.getElementById("countNo"),
    KeyZ: document.getElementById("countSi"),
    KeyX: document.getElementById("countVale"),
    KeyC: document.getElementById("countDacord"),
  };

  const combos = {
    Space: { el: document.getElementById("comboNo"), count: 0, timer: null, emoji: 'üî•' },
    KeyZ: { el: document.getElementById("comboSi"), count: 0, timer: null, emoji: 'üçÄ' },
    KeyX: { el: document.getElementById("comboVale"), count: 0, timer: null, emoji: 'üí¶' },
    KeyC: { el: document.getElementById("comboDacord"), count: 0, timer: null, emoji: '‚ú®' },
  };

  // Cookies
  function setCookie(name, value, days = 365) {
    const d = new Date();
    d.setTime(d.getTime() + (days*24*60*60*1000));
    document.cookie = name + "=" + value + ";expires=" + d.toUTCString() + ";path=/";
  }
  function getCookie(name) {
    const cookies = document.cookie.split("; ");
    for (let c of cookies) {
      const [key, val] = c.split("=");
      if (key === name) return val;
    }
    return null;
  }
  function deleteCookie(name) {
    document.cookie = name + "=;expires=Thu, 01 Jan 1970 00:00:00 UTC;path=/;";
  }

  // Carregar cookies
  for (const code in counters) {
    const saved = getCookie(code);
    if (saved !== null) counters[code].textContent = saved;
  }

  // Funci√≥ chiclin
  function applyChiclin(element) {
    element.style.animation = "none";
    void element.offsetWidth;
    element.style.animation = "chiclin 0.5s ease";
  }

  // Funci√≥ per animar el combo
  function animateCombo(comboEl) {
    comboEl.classList.remove("pop");
    void comboEl.offsetWidth;
    comboEl.classList.add("pop");
  }

  // Funci√≥ per amagar el combo amb animaci√≥
  function hideCombo(combo) {
    combo.el.classList.add("hide");
    setTimeout(() => {
      combo.count = 0;
      combo.el.textContent = "";
      combo.el.classList.remove("show", "hide");
    }, 300);
  }

  // Funci√≥ per reiniciar el temporitzador del combo
  function resetComboTimer(combo) {
    if (combo.timer) clearTimeout(combo.timer);
    combo.timer = setTimeout(() => {
      hideCombo(combo);
    }, 5000);
  }

  document.addEventListener("keydown", (event) => {
    if (event.shiftKey && (event.code === "Backspace" || event.code === "Delete")) {
      for (const code in counters) {
        counters[code].textContent = 0;
        deleteCookie(code);
        hideCombo(combos[code]);
        if (combos[code].timer) clearTimeout(combos[code].timer);
      }
      return;
    }

    if (counters[event.code] !== undefined) {
      let current = parseInt(counters[event.code].textContent,10);
      if (event.shiftKey) {
        current = Math.max(0,current-1);
        counters[event.code].textContent = current;

        // Aplica efectes chiclin quan es decrementa amb Shift
        applyChiclin(counters[event.code]);

        // Actualitza el combo si n'hi ha
        const combo = combos[event.code];
        if (combo.count > 0) {
          combo.count--;
          if (combo.count >= 1) { // Canviat de 2 a 1
            combo.el.textContent = "x" + combo.count;
            combo.el.classList.remove("hide");
            combo.el.classList.add("show");
            animateCombo(combo.el);
            // Reinicia el temporitzador del combo
            resetComboTimer(combo);
          } else {
            hideCombo(combo);
          }
        }
      } else {
        current++;
        counters[event.code].textContent = current;

        const combo = combos[event.code];
        combo.count++;

        // MODIFICACI√ì: Mostra el combo des d'1 en lloc de 2
        if(combo.count >= 1) { // Canviat de 2 a 1
          combo.el.textContent = "x" + combo.count;
          combo.el.classList.remove("hide");
          combo.el.classList.add("show");
          const numEl = counters[event.code];
          const offsetLeft = numEl.offsetLeft + numEl.offsetWidth + 5;
          combo.el.style.left = offsetLeft + "px";
          combo.el.style.top = numEl.offsetTop + "px";
          animateCombo(combo.el);
        } else {
          combo.el.textContent = "";
          combo.el.classList.remove("show");
        }

        // Reinicia el temporitzador del combo
        resetComboTimer(combo);

        const emojiEl = document.createElement("div");
        emojiEl.textContent = combo.emoji;
        const size = 60 + Math.random()*60;
        emojiEl.style.position = "absolute";
        const parentWidth = counters[event.code].parentElement.clientWidth;
        const maxLeft = parentWidth - size;
        const randomLeft = Math.random() * maxLeft;
        emojiEl.style.left = randomLeft + "px";
        emojiEl.style.bottom = "0px";
        emojiEl.style.fontSize = size + "px";
        emojiEl.style.pointerEvents = "none";
        emojiEl.style.transform = "rotate(0deg)";
        emojiEl.style.transition = "transform 2.5s linear, bottom 2.5s linear";
        emojiEl.style.zIndex = "0";
        counters[event.code].parentElement.appendChild(emojiEl);

        requestAnimationFrame(()=>{
          emojiEl.style.bottom = "100%";
          const rotateDeg = 360 + Math.random()*360;
          emojiEl.style.transform = `rotate(${rotateDeg}deg)`;
        });
        setTimeout(()=>{ emojiEl.remove(); },2500);

        applyChiclin(counters[event.code]);
      }

      setCookie(event.code,current);
    }
  });

  // Funci√≥ per incrementar el comptador
  function incrementCounter(code) {
    let current = parseInt(counters[code].textContent,10);
    current++;
    counters[code].textContent = current;

    const combo = combos[code];
    combo.count++;

    // MODIFICACI√ì: Mostra el combo des d'1 en lloc de 2
    if(combo.count >= 1) { // Canviat de 2 a 1
      combo.el.textContent = "x" + combo.count;
      combo.el.classList.remove("hide");
      combo.el.classList.add("show");
      const numEl = counters[code];
      const offsetLeft = numEl.offsetLeft + numEl.offsetWidth + 5;
      combo.el.style.left = offsetLeft + "px";
      combo.el.style.top = numEl.offsetTop + "px";
      animateCombo(combo.el);
    } else {
      combo.el.textContent = "";
      combo.el.classList.remove("show");
    }

    // Reinicia el temporitzador del combo
    resetComboTimer(combo);

    const emojiEl = document.createElement("div");
    emojiEl.textContent = combo.emoji;
    const size = 60 + Math.random()*60;
    emojiEl.style.position = "absolute";
    const parentWidth = counters[code].parentElement.clientWidth;
    const maxLeft = parentWidth - size;
    const randomLeft = Math.random() * maxLeft;
    emojiEl.style.left = randomLeft + "px";
    emojiEl.style.bottom = "0px";
    emojiEl.style.fontSize = size + "px";
    emojiEl.style.pointerEvents = "none";
    emojiEl.style.transform = "rotate(0deg)";
    emojiEl.style.transition = "transform 2.5s linear, bottom 2.5s linear";
    emojiEl.style.zIndex = "0";
    counters[code].parentElement.appendChild(emojiEl);

    requestAnimationFrame(()=>{
      emojiEl.style.bottom = "100%";
      const rotateDeg = 360 + Math.random()*360;
      emojiEl.style.transform = `rotate(${rotateDeg}deg)`;
    });
    setTimeout(()=>{ emojiEl.remove(); },2500);

    applyChiclin(counters[code]);
    setCookie(code,current);
  }

  // Funci√≥ per decrementar el comptador
  function decrementCounter(code) {
    let current = parseInt(counters[code].textContent,10);
    current = Math.max(0, current - 1);
    counters[code].textContent = current;

    // Aplica efecte chiclin quan es decrementa
    applyChiclin(counters[code]);

    // Actualitza el combo si n'hi ha
    const combo = combos[code];
    if (combo.count > 0) {
      combo.count--;
      if (combo.count >= 1) { // Canviat de 2 a 1
        combo.el.textContent = "x" + combo.count;
        combo.el.classList.remove("hide");
        combo.el.classList.add("show");
        animateCombo(combo.el);
        // Reinicia el temporitzador del combo
        resetComboTimer(combo);
      } else {
        hideCombo(combo);
      }
    }

    setCookie(code, current);
  }

  // Detecta si √©s m√≤bil/t√†ctil
  function isMobile() {
    return (typeof window.orientation !== "undefined") || (navigator.userAgent.indexOf('IEMobile') !== -1) || ('ontouchstart' in window && navigator.maxTouchPoints > 1);
  }

  // Controls din√†mics a la info
  function renderControlsInfo() {
    const controlsList = document.getElementById('controlsList');
    controlsList.innerHTML = '';
    if (isMobile()) {
      controlsList.innerHTML = `
        <li><b>Tap</b> ‚Üí +1 al comptador</li>
        <li><b>Mant√©n premut 1s</b> ‚Üí Comen√ßa a restar -1 cada 0.5s</li>
        <li><b>Bot√≥ ‚ü≤</b> (a dalt a l'esquerra) ‚Üí Reinici</li>
      `;
    } else {
      controlsList.innerHTML = `
        <li><b>Espai</b> ‚Üí +1 No?</li>
        <li><b>Z</b> ‚Üí +1 S√≠?</li>
        <li><b>X</b> ‚Üí +1 Vale?</li>
        <li><b>C</b> ‚Üí +1 D'acord?</li>
        <li><b>Shift + tecla</b> ‚Üí -1</li>
        <li><b>Clic dret</b> ‚Üí -1</li>
        <li><b>Shift + Supr/Backspace</b> ‚Üí Reinici</li>
      `;
    }
  }
  renderControlsInfo();

  // Suport t√†ctil/click per a cada comptador amb mantenir premut
  document.querySelectorAll('.counter').forEach(counterDiv => {
    let holdTimer = null;
    let repeatTimer = null;
    let holding = false;

    const code = counterDiv.getAttribute('data-code');

    function clearTimers() {
      if (holdTimer) { clearTimeout(holdTimer); holdTimer = null; }
      if (repeatTimer) { clearInterval(repeatTimer); repeatTimer = null; }
      holding = false;
    }

    // T√†ctil (nom√©s per a m√≤bil)
    if (isMobile()) {
      counterDiv.addEventListener('touchstart', function(e) {
        e.preventDefault();
        holding = false;
        holdTimer = setTimeout(() => {
          holding = true;
          decrementCounter(code);
          repeatTimer = setInterval(() => {
            decrementCounter(code);
          }, 500);
        }, 1000);
      }, {passive:false});

      counterDiv.addEventListener('touchend', function(e) {
        e.preventDefault();
        if (!holding) {
          incrementCounter(code);
        }
        clearTimers();
      }, {passive:false});

      counterDiv.addEventListener('touchmove', function(e) {
        clearTimers();
      }, {passive:false});
    } else {
      // Mouse (nom√©s per a desktop)
      counterDiv.addEventListener('mousedown', function(e) {
        // Clic dret per decrementar
        if (e.button === 2) {
          e.preventDefault();
          decrementCounter(code);
          return;
        }

        // Clic esquerra normal
        if (e.button === 0) {
          holding = false;
          holdTimer = setTimeout(() => {
            holding = true;
            decrementCounter(code);
            repeatTimer = setInterval(() => {
              decrementCounter(code);
            }, 500);
          }, 1000);
        }
      });

      counterDiv.addEventListener('mouseup', function(e) {
        if (e.button === 0 && !holding) {
          incrementCounter(code);
        }
        clearTimers();
      });

      counterDiv.addEventListener('mouseleave', function(e) {
        clearTimers();
      });

      // Prevenir el men√∫ contextual del clic dret
      counterDiv.addEventListener('contextmenu', function(e) {
        e.preventDefault();
      });
    }
  });

  // Bot√≥ reset m√≤bil
  const resetMobileBtn = document.getElementById('resetMobileBtn');
  resetMobileBtn.addEventListener('click', function() {
    for (const code in counters) {
      counters[code].textContent = 0;
      deleteCookie(code);
      hideCombo(combos[code]);
      if (combos[code].timer) clearTimeout(combos[code].timer);
    }
  });

  // Mostrar/ocultar bot√≥ reset segons dispositiu
  function updateResetBtnVisibility() {
    if (isMobile()) {
      resetMobileBtn.style.display = 'flex';
    } else {
      resetMobileBtn.style.display = 'none';
    }
  }
  updateResetBtnVisibility();

  window.addEventListener('resize', () => {
    updateResetBtnVisibility();
    renderControlsInfo();
  });

  // Informaci√≥
  const infoBtn = document.getElementById("infoBtn");
  const infoBox = document.getElementById("infoBox");
  const closeInfo = document.getElementById("closeInfo");
  infoBtn.addEventListener("click",()=>{
    renderControlsInfo();
    infoBox.style.display="block";
  });
  closeInfo.addEventListener("click",()=>{infoBox.style.display="none";});
</script>
</body>
</html>